<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… - Ø§Ù„Ø¥Ø­Ø³Ø§Ù†</title>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary: #1e88e5;
      --primary-dark: #1565c0;
      --secondary: #f5f7fa;
      --dark: #2c3e50;
      --light: #ecf0f1;
      --danger: #e74c3c;
      --success: #2ecc71;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background-color: #f8f9fa;
      color: var(--dark);
    }

    header {
      background-color: white;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 1rem 5%;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--primary);
    }

    nav a {
      margin: 0 15px;
      text-decoration: none;
      color: var(--dark);
      font-weight: 500;
    }

    main {
      padding: 30px 5%;
    }

    .page-title {
      font-size: 1.8rem;
      margin-bottom: 20px;
      color: var(--dark);
    }

    /* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© */
    .kpi-cards {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 30px;
    }

    .kpi {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      flex: 1;
      min-width: 200px;
      text-align: center;
    }

    .kpi h3 {
      font-size: 1.1rem;
      color: #555;
      margin-bottom: 10px;
    }

    .kpi .value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary);
    }

    /* Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ */
    .tables {
      display: flex;
      gap: 30px;
      flex-wrap: wrap;
    }

    .table-container {
      flex: 1;
      min-width: 300px;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    th, td {
      padding: 12px;
      text-align: right;
      border-bottom: 1px solid #eee;
    }

    th {
      background-color: #f1f3f5;
      color: #555;
    }

    /* Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ */
    .chart-container {
      width: 100%;
      max-width: 800px;
      margin: 30px auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    footer {
      text-align: center;
      padding: 30px;
      color: #777;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>

  <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
  <header>
    <div class="logo">Ø§Ù„Ø¥Ø­Ø³Ø§Ù†</div>
    <nav>
      <a href="index.html">Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
      <a href="#" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
    </nav>
  </header>

  <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
  <main>
	<h2 class="page-title">Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
    <!-- ØªÙ†Ø¨Ø¤ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© -->
		<div class="kpi">
		  <h3>Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø© (30 ÙŠÙˆÙ…)</h3>
	  <div class="value" id="cash-prediction">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
		</div>
    <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© -->
    <div class="kpi-cards">
      <div class="kpi">
        <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h3>
        <div class="value" id="total-employees">0</div>
      </div>
      <div class="kpi">
        <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</h3>
        <div class="value" id="total-invoices">0</div>
      </div>
      <div class="kpi">
        <h3>Ø§Ù„Ù…Ø¨Ù„Øº ØºÙŠØ± Ø§Ù„Ù…Ø³Ø¯Ø¯</h3>
        <div class="value" style="color: var(--danger);" id="unpaid-amount">0 Ø±.Ø³</div>
      </div>
      <div class="kpi">
        <h3>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</h3>
        <div class="value" style="color: var(--success);" id="new-leads">0</div>
      </div>
    </div>
<!-- ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ† -->
<div class="table-container">
  <h3>ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…Ù†Ø®ÙØ¶</h3>
  <table id="inventory-alerts">
    <thead>
      <tr>
        <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
        <th>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</th>
        <th>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰</th>
        <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…Ù‚ØªØ±Ø­</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>
<!-- ØªØ°Ø§ÙƒØ± Ø§Ù„Ø¯Ø¹Ù… -->
<div class="table-container">
  <h3>Ø£Ø­Ø¯Ø« ØªØ°Ø§ÙƒØ± Ø¯Ø¹Ù… Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h3>
  <table id="support-tickets">
    <thead>
      <tr>
        <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
        <th>Ø§Ù„Ù†ÙˆØ¹</th>
        <th>Ø§Ù„ÙˆØµÙ</th>
        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>
	<!-- ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø© -->
<div class="kpi-cards">
  <div class="kpi" style="background: #fff8e1;">
    <h3>Ù…Ø§ÙƒÙŠÙ†Ø§Øª ØªØ­ØªØ§Ø¬ ØµÙŠØ§Ù†Ø©</h3>
    <div id="maintenance-alert" style="font-size: 1.5rem; color: #f57c00;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</div>
  </div>
</div>
<!-- Ø´Ø§Øª Ø¨ÙˆØª Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø±Ù‚Ù…ÙŠ -->
<div class="table-container">
  <h3>Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø±Ù‚Ù…ÙŠ ğŸ¤–</h3>
  <div id="chatbox" style="height: 200px; overflow-y: scroll; border: 1px solid #ddd; padding: 10px; margin-bottom: 10px; background: #f9f9f9; border-radius: 8px;"></div>
  <div style="display: flex; gap: 10px;">
    <input type="text" id="userCommand" placeholder="Ø§Ø·Ø±Ø­ Ø³Ø¤Ø§Ù„Ø§Ù‹ Ø£Ùˆ Ø£ØµØ¯Ø± Ø£Ù…Ø±Ù‹Ø§..." style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
    <button onclick="sendCommand()" style="background: #1e88e5; color: white; border: none; padding: 10px 20px; border-radius: 8px;">Ø¥Ø±Ø³Ø§Ù„</button>
  </div>
</div>

    <!-- Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ -->
    <div class="tables">
      <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† -->
      <div class="table-container">
        <h3>Ø£Ø­Ø¯Ø« Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h3>
        <table id="employees-table">
          <thead>
            <tr>
              <th>Ø§Ù„Ø§Ø³Ù…</th>
              <th>Ø§Ù„ÙˆØ¸ÙŠÙØ©</th>
              <th>Ø§Ù„Ø±Ø§ØªØ¨</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙÙˆØ§ØªÙŠØ± -->
      <div class="table-container">
        <h3>Ø£Ø­Ø¯Ø« Ø§Ù„ÙÙˆØ§ØªÙŠØ±</h3>
        <table id="invoices-table">
          <thead>
            <tr>
              <th>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</th>
              <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
              <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
              <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ -->
    <div class="chart-container">
      <h3>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (ØªØ¬Ø±ÙŠØ¨ÙŠØ©)</h3>
      <canvas id="salesChart"></canvas>
    </div>

  </main>

  <!-- Ø§Ù„ØªØ°ÙŠÙŠÙ„ -->
  <footer>
    &copy; 2025 Ø´Ø±ÙƒØ© Ø§Ù„Ø¥Ø­Ø³Ø§Ù†. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.
  </footer>

  <script>
    // Ø¬Ù„Ø¨ ØªÙ†Ø¨Ø¤ Ø§Ù„Ø³ÙŠÙˆÙ„Ø©
async function fetchCashPrediction(companyId) {
  try {
    const res = await fetch(`http://127.0.0.1:8000/api/finance/cash-flow-prediction?company_id=${companyId}`);
    const data = await res.json();

    if (data.predicted_cash_in_next_30_days) {
      document.getElementById('cash-prediction').textContent = 
        `${Math.round(data.predicted_cash_in_next_30_days)} Ø±.Ø³`;
    } else {
      document.getElementById('cash-prediction').textContent = "ØºÙŠØ± Ù…ØªÙˆÙØ±";
    }
  } catch (error) {
    document.getElementById('cash-prediction').textContent = "Ø®Ø·Ø£";
  }
}
// Ø¬Ù„Ø¨ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
async function fetchInventoryAlerts(companyId) {
  try {
    const res = await fetch(`http://127.0.0.1:8000/api/inventory/low-stock?company_id=${companyId}`);
    const data = await res.json();
    const tbody = document.getElementById('inventory-alerts').querySelector('tbody');
    tbody.innerHTML = '';

    if (data.alerts && data.alerts.length > 0) {
      data.alerts.forEach(alert => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${alert.product}</td>
          <td>${alert.current}</td>
          <td>${alert.min}</td>
          <td>Ø·Ù„Ø¨ ${Math.round(alert.suggest_order)} ÙˆØ­Ø¯Ø©</td>
        `;
        tbody.appendChild(tr);
      });
    } else {
      const tr = document.createElement('tr');
      tr.innerHTML = '<td colspan="4">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù…Ø®Ø²ÙˆÙ†</td>';
      tbody.appendChild(tr);
    }
  } catch (error) {
    console.error('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†:', error);
    const tbody = document.getElementById('inventory-alerts').querySelector('tbody');
    tbody.innerHTML = '<tr><td colspan="4">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„</td></tr>';
  }
}
// Ø¬Ù„Ø¨ ØªØ°Ø§ÙƒØ± Ø§Ù„Ø¯Ø¹Ù…
async function fetchSupportTickets(companyId) {
  try {
    const res = await fetch(`http://127.0.0.1:8000/api/support?company_id=${companyId}`);
    const tickets = await res.json();
    const tbody = document.getElementById('support-tickets').querySelector('tbody');
    tbody.innerHTML = '';

    tickets.slice(0, 5).forEach(ticket => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${ticket.customer_name}</td>
        <td><span style="color: ${
          ticket.category === 'finance' ? 'blue' :
          ticket.category === 'technical' ? 'orange' : 'green'
        }">${ticket.category}</span></td>
        <td>${ticket.description.substring(0, 50)}...</td>
        <td><span style="color: ${ticket.status === 'open' ? 'red' : 'gray'}">${ticket.status === 'open' ? 'Ù…ÙØªÙˆØ­Ø©' : 'Ù…ØºÙ„Ù‚Ø©'}</span></td>
      `;
      tbody.appendChild(tr);
    });
  } catch (error) {
    console.error('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„ØªØ°Ø§ÙƒØ±:', error);
    const tbody = document.getElementById('support-tickets').querySelector('tbody');
    tbody.innerHTML = '<tr><td colspan="4">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„</td></tr>';
  }
}
// Ø¬Ù„Ø¨ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©
async function fetchMaintenanceAlert(companyId) {
  try {
    const res = await fetch(`http://127.0.0.1:8000/api/production/maintenance-alert?company_id=${companyId}`);
    const data = await res.json();
    const el = document.getElementById('maintenance-alert');

    if (data.high_risk_machines && data.high_risk_machines.length > 0) {
      el.innerHTML = data.high_risk_machines.join(', ') + ' ğŸ”§';
    } else {
      el.innerHTML = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø§ÙƒÙŠÙ†Ø§Øª Ù…Ø¹Ø±Ø¶Ø© Ù„Ù„Ø®Ø·Ø±';
    }
  } catch (error) {
    console.error('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©:', error);
    document.getElementById('maintenance-alert').textContent = 'Ø®Ø·Ø£';
  }
}
// Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£Ù…Ø± Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯
async function sendCommand() {
  const input = document.getElementById('userCommand');
  const text = input.value.trim();
  if (!text) return;

  // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
  addChatMessage("Ø£Ù†Øª", text, "blue");

  try {
    const res = await fetch('http://127.0.0.1:8000/api/agent/command', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ text, user_role: "admin", company_id: 1 })
    });

    const data = await res.json();
    const reply = data.interpreted.action === "unknown"
      ? "Ù„Ø§ Ø£ÙÙ‡Ù… Ù‡Ø°Ø§ Ø§Ù„Ø£Ù…Ø±. Ø¬Ø±Ø¨: 'Ø£Ø±Ø³Ù„ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª' Ø£Ùˆ 'ÙƒÙ… Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†ØŸ'"
      : `ØªÙ… ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ù…Ø±: ${data.interpreted.action}`;

    addChatMessage("Ø§Ù„Ø¥Ø­Ø³Ø§Ù†", reply, "green");
  } catch (error) {
    addChatMessage("Ø§Ù„Ø¥Ø­Ø³Ø§Ù†", "ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯.", "red");
  }

  input.value = "";
}

// Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø§Øª
function addChatMessage(sender, message, color) {
  const chatbox = document.getElementById('chatbox');
  const msg = document.createElement('div');
  msg.style.padding = "8px";
  msg.style.margin = "4px 0";
  msg.style.borderRadius = "8px";
  msg.style.backgroundColor = sender === "Ø£Ù†Øª" ? "#e3f2fd" : "#e8f5e8";
  msg.style.color = color;
  msg.style.maxWidth = "80%";
  msg.style.marginLeft = sender === "Ø£Ù†Øª" ? "auto" : "0";
  msg.style.textAlign = sender === "Ø£Ù†Øª" ? "left" : "right";
  msg.innerHTML = `<strong>${sender}:</strong> ${message}`;
  chatbox.appendChild(msg);
  chatbox.scrollTop = chatbox.scrollHeight;
}

// Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨
window.onload = function() {
  const user = localStorage.getItem('user');
  if (!user) {
    window.location.href = 'index.html';
  } else {
    const userData = JSON.parse(user);
    fetchData();
    fetchInventoryAlerts(userData.company_id);
    fetchSupportTickets(userData.company_id);
    fetchMaintenanceAlert(userData.company_id);
    
    // Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ ÙÙŠ Ø§Ù„Ø´Ø§Øª
    addChatMessage("Ø§Ù„Ø¥Ø­Ø³Ø§Ù†", "Ù…Ø±Ø­Ø¨Ù‹Ø§! Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø±Ù‚Ù…ÙŠ. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ", "green");
  }
};
// Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¯Ø§Ù„Ø© Ø¨Ø¹Ø¯ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
// Ø¯Ø§Ø®Ù„ window.onload Ø£Ùˆ Ø¨Ø¹Ø¯ login
fetchCashPrediction(user.company_id);
    // --- Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ ---
    const salesChartCtx = document.getElementById('salesChart').getContext('2d');
    new Chart(salesChartCtx, {
      type: 'bar',
      data: {
        labels: ['ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ'],
        datasets: [{
          label: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (Ø±.Ø³)',
          data: [12000, 19000, 15000, 22000, 18000],
          backgroundColor: '#1e88e5'
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });

    // --- Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Backend ---
    async function fetchData() {
      try {
        // Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
        const empRes = await fetch('http://127.0.0.1:8000/api/hr/employees?company_id=1');
        const employees = await empRes.json();
        document.getElementById('total-employees').textContent = employees.length;

        const empTbody = document.getElementById('employees-table').querySelector('tbody');
        empTbody.innerHTML = '';
        employees.slice(0, 5).forEach(emp => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${emp.name}</td>
            <td>${emp.position}</td>
            <td>${emp.salary} Ø±.Ø³</td>
          `;
          empTbody.appendChild(tr);
        });

        // Ø¬Ù„Ø¨ Ø§Ù„ÙÙˆØ§ØªÙŠØ±
        const invRes = await fetch('http://127.0.0.1:8000/api/finance/invoices?company_id=1');
        const invoices = await invRes.json();
        document.getElementById('total-invoices').textContent = invoices.length;

        let unpaidAmount = 0;
        invoices.forEach(inv => {
          if (inv.status === 'unpaid') {
            unpaidAmount += inv.amount;
          }
        });
        document.getElementById('unpaid-amount').textContent = `${unpaidAmount} Ø±.Ø³`;

        const invTbody = document.getElementById('invoices-table').querySelector('tbody');
        invTbody.innerHTML = '';
        invoices.slice(0, 5).forEach(inv => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${inv.invoice_number}</td>
            <td>${inv.customer_name}</td>
            <td>${inv.amount} Ø±.Ø³</td>
            <td><span style="color: ${inv.status === 'paid' ? 'green' : 'red'}">${inv.status === 'paid' ? 'Ù…Ø¯ÙÙˆØ¹Ø©' : 'ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹Ø©'}</span></td>
          `;
          invTbody.appendChild(tr);
        });

        // Ø¬Ù„Ø¨ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…Ø­ØªÙ…Ù„ÙŠÙ†
        const leadRes = await fetch('http://127.0.0.1:8000/api/leads');
        const leads = await leadRes.json();
        document.getElementById('new-leads').textContent = leads.length;

      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
        alert('ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù†Ø¸Ø§Ù…. ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù….');
      }
    }

    // --- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ ---
    function logout() {
      localStorage.removeItem('user');
      window.location.href = 'index.html';
    }

    // --- ØªÙ†ÙÙŠØ° Ø§Ù„Ø¬Ù„Ø¨ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ ---
    window.onload = function() {
      const user = localStorage.getItem('user');
      if (!user) {
        window.location.href = 'index.html';
      } else {
        fetchData(); // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù€ Backend
      }
    };
  </script>

</body>
</html>
