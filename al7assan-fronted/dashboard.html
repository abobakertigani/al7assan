<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… - Ø§Ù„Ø¥Ø­Ø³Ø§Ù†</title>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary: #1e88e5;
      --primary-dark: #1565c0;
      --secondary: #f5f7fa;
      --dark: #2c3e50;
      --light: #ecf0f1;
      --danger: #e74c3c;
      --success: #2ecc71;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background-color: #f8f9fa;
      color: var(--dark);
    }

    header {
      background-color: white;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 1rem 5%;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--primary);
    }

    nav a {
      margin: 0 15px;
      text-decoration: none;
      color: var(--dark);
      font-weight: 500;
    }

    main {
      padding: 30px 5%;
    }

    .page-title {
      font-size: 1.8rem;
      margin-bottom: 20px;
      color: var(--dark);
    }

    /* Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© */
    .kpi-cards {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 30px;
    }

    .kpi {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      flex: 1;
      min-width: 200px;
      text-align: center;
    }

    .kpi h3 {
      font-size: 1.1rem;
      color: #555;
      margin-bottom: 10px;
    }

    .kpi .value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary);
    }

    /* Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ */
    .tables {
      display: flex;
      gap: 30px;
      flex-wrap: wrap;
    }

    .table-container {
      flex: 1;
      min-width: 300px;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    th, td {
      padding: 12px;
      text-align: right;
      border-bottom: 1px solid #eee;
    }

    th {
      background-color: #f1f3f5;
      color: #555;
    }

    /* Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ */
    .chart-container {
      width: 100%;
      max-width: 800px;
      margin: 30px auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    footer {
      text-align: center;
      padding: 30px;
      color: #777;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>

  <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
  <header>
    <div class="logo">Ø§Ù„Ø¥Ø­Ø³Ø§Ù†</div>
    <nav>
      <a href="index.html">Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
      <a href="#" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
    </nav>
  </header>

  <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
  <main>
	    <!-- Ø£Ø¶Ù Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ù‡Ù†Ø§ -->
  <div class="tabs" style="display: flex; margin: 20px 0; border-bottom: 1px solid #ddd; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
    <div class="tab" onclick="switchTab('overview')" style="padding: 15px 25px; cursor: pointer; font-weight: 600; color: #555;">Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</div>
    <div class="tab" onclick="switchTab('hr')" style="padding: 15px 25px; cursor: pointer; color: #555;">Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©</div>
    <div class="tab" onclick="switchTab('finance')" style="padding: 15px 25px; cursor: pointer; color: #555;">Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø©</div>
    <div class="tab" onclick="switchTab('specialized')" style="padding: 15px 25px; cursor: pointer; color: #555;">Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø®ØµØµ</div>
  </div>

  <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
  <div id="tab-content">
    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ -->
  </div>
<h2 class="page-title">Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
   <!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø®ØµØµ -->
<div id="specialized-module" style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin: 30px 0;">
  <h3>Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø®ØµØµ</h3>
  <p>Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ø­Ø³Ø¨ Ù…Ø¬Ø§Ù„ Ø¹Ù…Ù„Ùƒ.</p>
</div>
	  
    <!-- ØªÙ†Ø¨Ø¤ Ø§Ù„Ø³ÙŠÙˆÙ„Ø© -->
		<div class="kpi">
		  <h3>Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø© (30 ÙŠÙˆÙ…)</h3>
	  <div class="value" id="cash-prediction">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
		</div>
    <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© -->
    <div class="kpi-cards">
      <div class="kpi">
        <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h3>
        <div class="value" id="total-employees">0</div>
      </div>
      <div class="kpi">
        <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</h3>
        <div class="value" id="total-invoices">0</div>
      </div>
      <div class="kpi">
        <h3>Ø§Ù„Ù…Ø¨Ù„Øº ØºÙŠØ± Ø§Ù„Ù…Ø³Ø¯Ø¯</h3>
        <div class="value" style="color: var(--danger);" id="unpaid-amount">0 Ø±.Ø³</div>
      </div>
      <div class="kpi">
        <h3>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</h3>
        <div class="value" style="color: var(--success);" id="new-leads">0</div>
      </div>
    </div>
	  <!-- ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¬ÙˆØ¯Ø© -->
<div class="kpi" style="background: #f3e5f5;">
  <h3>Ø¬ÙˆØ¯Ø© Ø§Ù„Ø¥Ù†ØªØ§Ø¬</h3>
  <div id="quality-report">
    Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...
  </div>
</div>
	  <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… -->
<div class="kpi-cards">
  <div class="kpi" style="background: #e8f5e8;">
    <h3>Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù… ğŸ–¥ï¸</h3>
    <div id="system-health">
      Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...
    </div>
  </div>
</div>
	  <!-- Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ -->
<div class="table-container" style="border: 2px solid #1e88e5; background: #e3f2fd;">
  <h3>ğŸ“‹ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ Ø§Ù„ÙŠÙˆÙ…ÙŠ</h3>
  <div id="executive-report">
    Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ±...
  </div>
</div>
	  
	  <!-- ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØ³ÙˆÙŠÙ‚ -->
<div class="table-container">
  <h3>ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ğŸ¯</h3>
  <div id="marketing-insights">
    <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ­Ù„ÙŠÙ„...</p>
  </div>
</div>
	  
<!-- ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ† -->
<div class="table-container">
  <h3>ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…Ù†Ø®ÙØ¶</h3>
  <table id="inventory-alerts">
    <thead>
      <tr>
        <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
        <th>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</th>
        <th>Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰</th>
        <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…Ù‚ØªØ±Ø­</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>
<!-- ØªØ°Ø§ÙƒØ± Ø§Ù„Ø¯Ø¹Ù… -->
<div class="table-container">
  <h3>Ø£Ø­Ø¯Ø« ØªØ°Ø§ÙƒØ± Ø¯Ø¹Ù… Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h3>
  <table id="support-tickets">
    <thead>
      <tr>
        <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
        <th>Ø§Ù„Ù†ÙˆØ¹</th>
        <th>Ø§Ù„ÙˆØµÙ</th>
        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>
	<!-- ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø© -->
<div class="kpi-cards">
  <div class="kpi" style="background: #fff8e1;">
    <h3>Ù…Ø§ÙƒÙŠÙ†Ø§Øª ØªØ­ØªØ§Ø¬ ØµÙŠØ§Ù†Ø©</h3>
    <div id="maintenance-alert" style="font-size: 1.5rem; color: #f57c00;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...</div>
  </div>
</div>
<!-- Ø´Ø§Øª Ø¨ÙˆØª Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø±Ù‚Ù…ÙŠ -->
<div class="table-container">
  <h3>Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø±Ù‚Ù…ÙŠ ğŸ¤–</h3>
  <div id="chatbox" style="height: 200px; overflow-y: scroll; border: 1px solid #ddd; padding: 10px; margin-bottom: 10px; background: #f9f9f9; border-radius: 8px;"></div>
  <div style="display: flex; gap: 10px;">
    <input type="text" id="userCommand" placeholder="Ø§Ø·Ø±Ø­ Ø³Ø¤Ø§Ù„Ø§Ù‹ Ø£Ùˆ Ø£ØµØ¯Ø± Ø£Ù…Ø±Ù‹Ø§..." style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
    <button onclick="sendCommand()" style="background: #1e88e5; color: white; border: none; padding: 10px 20px; border-radius: 8px;">Ø¥Ø±Ø³Ø§Ù„</button>
  </div>
</div>

    <!-- Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ -->
    <div class="tables">
      <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† -->
      <div class="table-container">
        <h3>Ø£Ø­Ø¯Ø« Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h3>
        <table id="employees-table">
          <thead>
            <tr>
              <th>Ø§Ù„Ø§Ø³Ù…</th>
              <th>Ø§Ù„ÙˆØ¸ÙŠÙØ©</th>
              <th>Ø§Ù„Ø±Ø§ØªØ¨</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙÙˆØ§ØªÙŠØ± -->
      <div class="table-container">
        <h3>Ø£Ø­Ø¯Ø« Ø§Ù„ÙÙˆØ§ØªÙŠØ±</h3>
        <table id="invoices-table">
          <thead>
            <tr>
              <th>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</th>
              <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
              <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
              <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ -->
    <div class="chart-container">
      <h3>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (ØªØ¬Ø±ÙŠØ¨ÙŠØ©)</h3>
      <canvas id="salesChart"></canvas>
    </div>

  </main>

  <!-- Ø§Ù„ØªØ°ÙŠÙŠÙ„ -->
  <footer>
    &copy; 2025 Ø´Ø±ÙƒØ© Ø§Ù„Ø¥Ø­Ø³Ø§Ù†. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.
  </footer>

  <script>
	  // --- ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¬Ø§Ù„ ---
const companyField = localStorage.getItem('company_field');
const user = JSON.parse(localStorage.getItem('user'));

if (!user) {
  window.location.href = 'index.html';
}

// --- Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ØºÙŠØ± Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠØ© ---
function hideSection(selector) {
  const el = document.querySelector(selector);
  if (el) el.style.display = 'none';
}

// --- Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¬Ø§Ù„ ---
function showSpecializedSection() {
  const container = document.getElementById('specialized-module');
  if (!container) return;

  const modules = {
    aquaculture: { title: "Ø§Ù„Ø§Ø³ØªØ²Ø±Ø§Ø¹", desc: "Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…Ø²Ø§Ø±Ø¹ØŒ Ø§Ù„ØªØºØ°ÙŠØ©ØŒ Ø§Ù„ØµØ­Ø©" },
    manufacturing: { title: "Ø§Ù„ØµÙ†Ø§Ø¹Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„ÙŠØ©", desc: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ù†ØªØ§Ø¬ ÙˆØ§Ù„Ø¬ÙˆØ¯Ø©" },
    solar: { title: "Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø´Ù…Ø³ÙŠØ©", desc: "Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ø­ ÙˆØ¥Ù†ØªØ§Ø¬ Ø§Ù„Ø·Ø§Ù‚Ø©" },
    construction: { title: "Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡Ø§Øª", desc: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ ÙˆØ§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠØ©" },
    education: { title: "Ø§Ù„ØªØ¹Ù„ÙŠÙ…", desc: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„Ù…Ù†Ø§Ù‡Ø¬" },
    hse: { title: "Ø§Ù„ØµØ­Ø© ÙˆØ§Ù„Ø³Ù„Ø§Ù…Ø©", desc: "Ø§Ù„ØªÙØªÙŠØ´Ø§ØªØŒ Ø§Ù„Ø­ÙˆØ§Ø¯Ø«ØŒ Ø§Ù„ØªØ¯Ø±ÙŠØ¨" },
    logistics: { title: "Ø§Ù„Ù†Ù‚Ù„ ÙˆØ§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª", desc: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø·ÙˆÙ„ ÙˆØ§Ù„ØªÙˆØµÙŠÙ„" },
    hospitality: { title: "Ø§Ù„Ø³ÙŠØ§Ø­Ø© ÙˆØ§Ù„ÙÙ†Ø¯Ù‚Ø©", desc: "Ø§Ù„Ø­Ø¬ÙˆØ²Ø§ØªØŒ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØºØ±Ù" },
    security: { title: "Ø§Ù„Ø³ÙƒÙŠÙˆØ±ÙŠØªÙŠ", desc: "Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©ØŒ Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ø£Ù…Ù†ÙŠØ©" },
    trading: { title: "Ø§Ù„ØªØ¬Ø§Ø±Ø©", desc: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙˆØ§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª" }
  };

  const mod = modules[companyField];
  if (mod) {
    container.innerHTML = `
      <h3>${mod.title}</h3>
      <p style="color: #555; margin-bottom: 20px;">${mod.desc}</p>
      <div id="module-content">
        <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
      </div>
    `;
    loadModuleData(); // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù€ API
  } else {
    container.innerHTML = `<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Ø¸Ø§Ù… Ù…Ø®ØµØµ Ù…ÙØ¹Ù‘Ù„ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¬Ø§Ù„.</p>`;
  }
}

// --- Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ù…Ø®ØµØµØ© ---
async function loadModuleData() {
  const content = document.getElementById('module-content');
  try {
    const res = await fetch(`http://127.0.0.1:8000/api/${companyField}/alerts?company_id=${user.company_id}`);
    const data = await res.json();
    
    if (data.alerts && data.alerts.length > 0) {
      content.innerHTML = `
        <h4>ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</h4>
        <ul style="list-style: none; padding: 0;">
          ${data.alerts.map(a => `
            <li style="padding: 10px; margin: 5px 0; background: ${a.severity === 'high' ? '#f8d7da' : '#fff3cd'}; border-radius: 5px;">
              <strong>${a.type}</strong>: ${a.message}
            </li>
          `).join('')}
        </ul>
      `;
    } else {
      content.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø­Ø§Ù„ÙŠÙ‹Ø§.</p>';
    }
  } catch (error) {
    content.innerHTML = '<p>ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</p>';
    console.error(error);
  }
}
	  // --- Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ---
async function fetchEmployees() {
  try {
    const res = await fetch(`http://127.0.0.1:8000/api/hr/employees?company_id=${user.company_id}`);
    const employees = await res.json();
    const tbody = document.querySelector('#employees-table tbody');
    tbody.innerHTML = '';
    employees.forEach(emp => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${emp.name}</td>
        <td>${emp.position}</td>
        <td>${emp.salary} Ø±.Ø³</td>
      `;
      tbody.appendChild(tr);
    });
  } catch (error) {
    console.error('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†:', error);
  }
}

// --- Ø¬Ù„Ø¨ Ø§Ù„ÙÙˆØ§ØªÙŠØ± ---
async function fetchInvoices() {
  try {
    const res = await fetch(`http://127.0.0.1:8000/api/finance/invoices?company_id=${user.company_id}`);
    const invoices = await res.json();
    const tbody = document.querySelector('#invoices-table tbody');
    tbody.innerHTML = '';
    invoices.forEach(inv => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${inv.invoice_number}</td>
        <td>${inv.customer_name}</td>
        <td>${inv.amount} Ø±.Ø³</td>
        <td><span style="color: ${inv.status === 'paid' ? 'green' : 'red'}">${inv.status === 'paid' ? 'Ù…Ø¯ÙÙˆØ¹Ø©' : 'ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹Ø©'}</span></td>
      `;
      tbody.appendChild(tr);
    });
  } catch (error) {
    console.error('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„ÙÙˆØ§ØªÙŠØ±:', error);
  }
}

	  // Ø¬Ù„Ø¨ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØ³ÙˆÙŠÙ‚
async function fetchMarketingInsights(companyId) {
  try {
    const res = await fetch(`http://127.0.0.1:8000/api/marketing/insights?company_id=${companyId}`);
    const data = await res.json();
    const container = document.getElementById('marketing-insights');
    
    if (data.customer_segments) {
      container.innerHTML = `
        <p><strong>Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù†Ø´Ø·ÙˆÙ†:</strong> ${data.customer_segments.active}</p>
        <p><strong>Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù†Ø§Ø¦Ù…ÙˆÙ†:</strong> ${data.customer_segments.dormant}</p>
        <p><strong>Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…Ù…ÙŠØ²ÙˆÙ† (VIP):</strong> ${data.customer_segments.vip}</p>
        <h4>Ø§Ù„ØªÙˆØµÙŠØ§Øª:</h4>
        <ul style="text-align: right;">
          ${data.recommendations.map(r => `<li>${r}</li>`).join('')}
        </ul>
      `;
    } else {
      container.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§ÙÙŠØ© Ø¨Ø¹Ø¯.</p>';
    }
  } catch (error) {
    console.error('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØ³ÙˆÙŠÙ‚:', error);
    document.getElementById('marketing-insights').innerHTML = '<p style="color: red;">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„</p>';
  }
}
	  // Ø¬Ù„Ø¨ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¬ÙˆØ¯Ø©
async function fetchQualityReport(companyId) {
  try {
    const res = await fetch(`http://127.0.0.1:8000/api/quality/report?company_id=${companyId}`);
    const data = await res.json();
    const el = document.getElementById('quality-report');
    
    if (data.total_defects > 0) {
      el.innerHTML = `
        <p>âš ï¸ ${data.total_defects} Ø¹ÙŠØ¨Ù‹Ø§ ØªÙ… Ø§ÙƒØªØ´Ø§ÙÙ‡</p>
        <p>Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ: <strong>${data.top_issue}</strong></p>
        <p>Ø§Ù„ØªÙˆØµÙŠØ©: ${data.recommendation}</p>
      `;
    } else {
      el.innerHTML = '<p style="color: green;">âœ… Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´ÙƒÙ„Ø§Øª ÙÙŠ Ø§Ù„Ø¬ÙˆØ¯Ø©</p>';
    }
  } catch (error) {
    console.error('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¬ÙˆØ¯Ø©:', error);
    document.getElementById('quality-report').textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„';
  }
}
	  // Ø¬Ù„Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
async function fetchSystemHealth() {
  try {
    const res = await fetch('http://127.0.0.1:8000/api/it/health');
    const health = await res.json();
    const el = document.getElementById('system-health');
    
    const statusColor = health.status === 'Ù…Ø³ØªÙ‚Ø±' ? 'green' : 'red';
    
    el.innerHTML = `
      <p>CPU: ${health.cpu_usage}%</p>
      <p>Ø§Ù„Ø°Ø§ÙƒØ±Ø©: ${health.memory_usage}%</p>
      <p>Ø§Ù„Ù‚Ø±Øµ: ${health.disk_usage}%</p>
      <p>Ø§Ù„Ø­Ø§Ù„Ø©: <span style="color: ${statusColor};">${health.status}</span></p>
    `;
  } catch (error) {
    console.error('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…:', error);
    document.getElementById('system-health').textContent = 'ØºÙŠØ± Ù…ØªØµÙ„';
  }
}

// Ø¬Ù„Ø¨ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
async function fetchSystemAlerts() {
  try {
    const res = await fetch('http://127.0.0.1:8000/api/it/alerts');
    const data = await res.json();
    const count = data.alerts.length;
    if (count > 0) {
      alert(`âš ï¸ ${count} ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù†Ø¸Ø§Ù…: ${data.alerts.join(', ')}`);
    }
  } catch (error) {
    console.error('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…');
  }
}
	  // Ø¬Ù„Ø¨ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ
async function fetchExecutiveReport(companyId) {
  try {
    const res = await fetch(`http://127.0.0.1:8000/api/executive/daily-report?company_id=${companyId}`);
    const report = await res.json();
    const el = document.getElementById('executive-report');
    
    el.innerHTML = `
      <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${report.date}</p>
      <p><strong>Ø§Ù„Ù‚Ø¶Ø§ÙŠØ§ Ø§Ù„Ø­Ø±Ø¬Ø©:</strong> ${report.critical_issues}</p>
      <p><strong>Ù…Ù„Ø®Øµ:</strong> ${report.summary}</p>
      <h4>Ø§Ù„ØªÙˆØµÙŠØ§Øª:</h4>
      <ul style="text-align: right;">
        ${report.recommendations.map(r => `<li>${r}</li>`).join('')}
      </ul>
    `;
  } catch (error) {
    console.error('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ:', error);
    document.getElementById('executive-report').textContent = 'ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±.';
  }
}
    // Ø¬Ù„Ø¨ ØªÙ†Ø¨Ø¤ Ø§Ù„Ø³ÙŠÙˆÙ„Ø©
async function fetchCashPrediction(companyId) {
  try {
    const res = await fetch(`http://127.0.0.1:8000/api/finance/cash-flow-prediction?company_id=${companyId}`);
    const data = await res.json();

    if (data.predicted_cash_in_next_30_days) {
      document.getElementById('cash-prediction').textContent = 
        `${Math.round(data.predicted_cash_in_next_30_days)} Ø±.Ø³`;
    } else {
      document.getElementById('cash-prediction').textContent = "ØºÙŠØ± Ù…ØªÙˆÙØ±";
    }
  } catch (error) {
    document.getElementById('cash-prediction').textContent = "Ø®Ø·Ø£";
  }
}
// Ø¬Ù„Ø¨ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
async function fetchInventoryAlerts(companyId) {
  try {
    const res = await fetch(`http://127.0.0.1:8000/api/inventory/low-stock?company_id=${companyId}`);
    const data = await res.json();
    const tbody = document.getElementById('inventory-alerts').querySelector('tbody');
    tbody.innerHTML = '';

    if (data.alerts && data.alerts.length > 0) {
      data.alerts.forEach(alert => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${alert.product}</td>
          <td>${alert.current}</td>
          <td>${alert.min}</td>
          <td>Ø·Ù„Ø¨ ${Math.round(alert.suggest_order)} ÙˆØ­Ø¯Ø©</td>
        `;
        tbody.appendChild(tr);
      });
    } else {
      const tr = document.createElement('tr');
      tr.innerHTML = '<td colspan="4">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù…Ø®Ø²ÙˆÙ†</td>';
      tbody.appendChild(tr);
    }
  } catch (error) {
    console.error('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†:', error);
    const tbody = document.getElementById('inventory-alerts').querySelector('tbody');
    tbody.innerHTML = '<tr><td colspan="4">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„</td></tr>';
  }
}
// Ø¬Ù„Ø¨ ØªØ°Ø§ÙƒØ± Ø§Ù„Ø¯Ø¹Ù…
async function fetchSupportTickets(companyId) {
  try {
    const res = await fetch(`http://127.0.0.1:8000/api/support?company_id=${companyId}`);
    const tickets = await res.json();
    const tbody = document.getElementById('support-tickets').querySelector('tbody');
    tbody.innerHTML = '';

    tickets.slice(0, 5).forEach(ticket => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${ticket.customer_name}</td>
        <td><span style="color: ${
          ticket.category === 'finance' ? 'blue' :
          ticket.category === 'technical' ? 'orange' : 'green'
        }">${ticket.category}</span></td>
        <td>${ticket.description.substring(0, 50)}...</td>
        <td><span style="color: ${ticket.status === 'open' ? 'red' : 'gray'}">${ticket.status === 'open' ? 'Ù…ÙØªÙˆØ­Ø©' : 'Ù…ØºÙ„Ù‚Ø©'}</span></td>
      `;
      tbody.appendChild(tr);
    });
  } catch (error) {
    console.error('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„ØªØ°Ø§ÙƒØ±:', error);
    const tbody = document.getElementById('support-tickets').querySelector('tbody');
    tbody.innerHTML = '<tr><td colspan="4">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„</td></tr>';
  }
}
// Ø¬Ù„Ø¨ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©
async function fetchMaintenanceAlert(companyId) {
  try {
    const res = await fetch(`http://127.0.0.1:8000/api/production/maintenance-alert?company_id=${companyId}`);
    const data = await res.json();
    const el = document.getElementById('maintenance-alert');

    if (data.high_risk_machines && data.high_risk_machines.length > 0) {
      el.innerHTML = data.high_risk_machines.join(', ') + ' ğŸ”§';
    } else {
      el.innerHTML = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø§ÙƒÙŠÙ†Ø§Øª Ù…Ø¹Ø±Ø¶Ø© Ù„Ù„Ø®Ø·Ø±';
    }
  } catch (error) {
    console.error('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø©:', error);
    document.getElementById('maintenance-alert').textContent = 'Ø®Ø·Ø£';
  }
}
// Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£Ù…Ø± Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯
async function sendCommand() {
  const input = document.getElementById('userCommand');
  const text = input.value.trim();
  if (!text) return;

  // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
  addChatMessage("Ø£Ù†Øª", text, "blue");

  try {
    const res = await fetch('http://127.0.0.1:8000/api/agent/command', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ text, user_role: "admin", company_id: 1 })
    });

    const data = await res.json();
    const reply = data.interpreted.action === "unknown"
      ? "Ù„Ø§ Ø£ÙÙ‡Ù… Ù‡Ø°Ø§ Ø§Ù„Ø£Ù…Ø±. Ø¬Ø±Ø¨: 'Ø£Ø±Ø³Ù„ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª' Ø£Ùˆ 'ÙƒÙ… Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†ØŸ'"
      : `ØªÙ… ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ù…Ø±: ${data.interpreted.action}`;

    addChatMessage("Ø§Ù„Ø¥Ø­Ø³Ø§Ù†", reply, "green");
  } catch (error) {
    addChatMessage("Ø§Ù„Ø¥Ø­Ø³Ø§Ù†", "ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯.", "red");
  }

  input.value = "";
}

// Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø§Øª
function addChatMessage(sender, message, color) {
  const chatbox = document.getElementById('chatbox');
  const msg = document.createElement('div');
  msg.style.padding = "8px";
  msg.style.margin = "4px 0";
  msg.style.borderRadius = "8px";
  msg.style.backgroundColor = sender === "Ø£Ù†Øª" ? "#e3f2fd" : "#e8f5e8";
  msg.style.color = color;
  msg.style.maxWidth = "80%";
  msg.style.marginLeft = sender === "Ø£Ù†Øª" ? "auto" : "0";
  msg.style.textAlign = sender === "Ø£Ù†Øª" ? "left" : "right";
  msg.innerHTML = `<strong>${sender}:</strong> ${message}`;
  chatbox.appendChild(msg);
  chatbox.scrollTop = chatbox.scrollHeight;
}

// ØªÙ†ÙÙŠØ° ÙƒÙ„ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
window.onload = function() {
  const user = localStorage.getItem('user');
  if (!user) {
    window.location.href = 'index.html';
  } else {
    const userData = JSON.parse(user);

    // Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
    fetchData();
    fetchCashPrediction(userData.company_id);
    fetchInventoryAlerts(userData.company_id);
    fetchSupportTickets(userData.company_id);
    fetchMaintenanceAlert(userData.company_id);

    // Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    fetchMarketingInsights(userData.company_id);
    fetchQualityReport(userData.company_id);
    fetchSystemHealth();
    fetchSystemAlerts(); // ØªØ¸Ù‡Ø± ÙƒØªÙ†Ø¨ÙŠÙ‡
    fetchExecutiveReport(userData.company_id);

    // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø¯Ø§Ù„Ø© Ø¨Ø¹Ø¯ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    // Ø¯Ø§Ø®Ù„ window.onload Ø£Ùˆ Ø¨Ø¹Ø¯ login
    fetchCashPrediction(user.company_id);
	  
    // Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ ÙÙŠ Ø§Ù„Ø´Ø§Øª
    addChatMessage("Ø§Ù„Ø¥Ø­Ø³Ø§Ù†", "Ù…Ø±Ø­Ø¨Ù‹Ø§! Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø±Ù‚Ù…ÙŠ. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ", "green");

  }
};
	
// --- Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ ---
function initChart() {
  const ctx = document.getElementById('salesChart');
  if (!ctx) return;
  new Chart(ctx.getContext('2d'), {
    type: 'bar',// --- Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ ---
function initChart() {
  const ctx = document.getElementById('salesChart');
  if (!ctx) return;
  new Chart(ctx.getContext('2d'), {
    type: 'bar',
    data: {
      labels: ['ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„'],
      datasets: [{
        label: 'Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (Ø±.Ø³)',
        data: [12000, 19000, 15000, 22000],
        backgroundColor: '#1e88e5'
      }]
    },
    options: { responsive: true }
  });
}

    // --- Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Backend ---
    async function fetchData() {
      try {
        // Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
        const empRes = await fetch('http://127.0.0.1:8000/api/hr/employees?company_id=1');
        const employees = await empRes.json();
        document.getElementById('total-employees').textContent = employees.length;

        const empTbody = document.getElementById('employees-table').querySelector('tbody');
        empTbody.innerHTML = '';
        employees.slice(0, 5).forEach(emp => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${emp.name}</td>
            <td>${emp.position}</td>
            <td>${emp.salary} Ø±.Ø³</td>
          `;
          empTbody.appendChild(tr);
        });

        // Ø¬Ù„Ø¨ Ø§Ù„ÙÙˆØ§ØªÙŠØ±
        const invRes = await fetch('http://127.0.0.1:8000/api/finance/invoices?company_id=1');
        const invoices = await invRes.json();
        document.getElementById('total-invoices').textContent = invoices.length;

        let unpaidAmount = 0;
        invoices.forEach(inv => {
          if (inv.status === 'unpaid') {
            unpaidAmount += inv.amount;
          }
        });
        document.getElementById('unpaid-amount').textContent = `${unpaidAmount} Ø±.Ø³`;

        const invTbody = document.getElementById('invoices-table').querySelector('tbody');
        invTbody.innerHTML = '';
        invoices.slice(0, 5).forEach(inv => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${inv.invoice_number}</td>
            <td>${inv.customer_name}</td>
            <td>${inv.amount} Ø±.Ø³</td>
            <td><span style="color: ${inv.status === 'paid' ? 'green' : 'red'}">${inv.status === 'paid' ? 'Ù…Ø¯ÙÙˆØ¹Ø©' : 'ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹Ø©'}</span></td>
          `;
          invTbody.appendChild(tr);
        });

        // Ø¬Ù„Ø¨ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…Ø­ØªÙ…Ù„ÙŠÙ†
        const leadRes = await fetch('http://127.0.0.1:8000/api/leads');
        const leads = await leadRes.json();
        document.getElementById('new-leads').textContent = leads.length;

      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
        alert('ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù†Ø¸Ø§Ù…. ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Ø§Ù„Ø®Ø§Ø¯Ù….');
      }
	      // Ø¬Ù„Ø¨ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆØ­Ø¯Ø§Øª
  const modules = ['aquaculture', 'manufacturing', 'solar', 'construction', 'education', 'hse', 'logistics', 'hospitality', 'security', 'trading'];
  let totalAlerts = 0;

  for (const mod of modules) {
    try {
      const res = await fetch(`http://127.0.0.1:8000/api/${mod}/alerts?company_id=${user.company_id}`);
      const data = await res.json();
      if (data.alerts) {
        totalAlerts += data.alerts.length;
      }
    } catch (error) {
      console.log(`ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ${mod}`);
    }
  }

  document.getElementById('new-leads').textContent = totalAlerts;
    }
	  // --- Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª ---
function switchTab(tab) {
  const tabContent = document.getElementById('tab-content');

  // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø³Ø§Ø¨Ù‚
  tabContent.innerHTML = '';

  if (tab === 'overview') {
    tabContent.innerHTML = `
      <h3>Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</h3>
      <div class="kpi-cards">
        <div class="kpi"><h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h3><div class="value" id="total-employees">0</div></div>
        <div class="kpi"><h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</h3><div class="value" id="total-invoices">0</div></div>
        <div class="kpi"><h3>ØºÙŠØ± Ø§Ù„Ù…Ø³Ø¯Ø¯Ø©</h3><div class="value" style="color: var(--danger);" id="unpaid-amount">0 Ø±.Ø³</div></div>
        <div class="kpi"><h3>Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</h3><div class="value" style="color: var(--success);" id="new-leads">0</div></div>
      </div>

      <div class="chart-container">
        <h3>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h3>
        <canvas id="salesChart"></canvas>
      </div>
    `;
    fetchData(); // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    initChart(); // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
  }

  else if (tab === 'hr') {
    tabContent.innerHTML = `
      <h3>Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h3>
      <div class="table-container">
        <table id="employees-table">
          <thead>
            <tr>
              <th>Ø§Ù„Ø§Ø³Ù…</th>
              <th>Ø§Ù„ÙˆØ¸ÙŠÙØ©</th>
              <th>Ø§Ù„Ø±Ø§ØªØ¨</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    `;
    fetchEmployees();
  }

  else if (tab === 'finance') {
    tabContent.innerHTML = `
      <h3>Ø§Ù„ÙÙˆØ§ØªÙŠØ±</h3>
      <div class="table-container">
        <table id="invoices-table">
          <thead>
            <tr>
              <th>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</th>
              <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
              <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
              <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    `;
    fetchInvoices();
  }

  else if (tab === 'specialized') {
    tabContent.innerHTML = `
      <h3 id="module-title">Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø®ØµØµ</h3>
      <div id="module-content">
        <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø®ØµØµ...</p>
      </div>
    `;
    loadModuleData();
  }
}

    // --- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ ---
    function logout() {
      localStorage.removeItem('user');
      window.location.href = 'index.html';
    }

window.onload = function() {
  const savedTab = localStorage.getItem('activeTab') || 'overview';
  switchTab(savedTab);

  // Ø­ÙØ¸ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø­Ø§Ù„ÙŠ
  document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', (e) => {
      const tabName = e.target.getAttribute('onclick').match(/'(.+?)'/)[1];
      localStorage.setItem('activeTab', tabName);
    });
  });
};
  </script>

</body>
</html>
